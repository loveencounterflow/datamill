{
  "version": 3,
  "file": "render-as-html.js",
  "sourceRoot": "..",
  "sources": [
    "src/render-as-html.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n\n\n'use strict'\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DATAMILL/MAIN'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n{ jr\n  assign }                = CND\n#...........................................................................................................\nrequire                   './exception-handler'\nfirst                     = Symbol 'first'\nlast                      = Symbol 'last'\nMIRAGE                    = require 'mkts-mirage'\nVNR                       = require './vnr'\n#...........................................................................................................\nPD                        = require 'pipedreams'\n{ $\n  $watch\n  $async\n  select\n  stamp }                 = PD\n#...........................................................................................................\n@types                    = require './types'\n{ isa\n  validate\n  declare\n  first_of\n  last_of\n  size_of\n  type_of }               = @types\n#...........................................................................................................\nH                         = require './helpers'\n{ cwd_abspath\n  cwd_relpath\n  here_abspath\n  project_abspath }       = H\n#...........................................................................................................\nDM                        = require '..'\n\n#-----------------------------------------------------------------------------------------------------------\n@$decorations = ( S ) -> $ { first, last, }, ( d, send ) =>\n  if d is first\n    send H.fresh_datom '^html', { text: '<html><body>', ref: 'rdh/deco-1', $vnr: [ -Infinity, ], }\n  if d is last\n    send H.fresh_datom '^html', { text: '</body></html>', ref: 'rdh/deco-2', $vnr: [ Infinity, ], }\n  else\n    send d\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$p = ( S ) ->\n  return PD.lookaround $ ( d3, send ) =>\n    [ prv, d, nxt, ] = d3\n    return send d unless select d, '^mktscript'\n    text = d.text\n    if select prv, '<p'\n      text  = \"<p>#{text}\"\n    if select nxt, '>p'\n      text  = \"#{text}</p>\"\n    $vnr = VNR.deepen d.$vnr\n    send H.fresh_datom '^html', { text: text, ref: 'rdh/p', $vnr, }\n    send d\n    return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# @$mktscript = ( S ) -> $ ( d, send ) =>\n#   if select d, '^mktscript'\n#     $vnr = VNR.deepen d.$vnr\n#     send H.fresh_datom '^html', { text: d.text, ref: 'rdh/mkts-1', $vnr, }\n#     send d\n#   else\n#     send d\n#   return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$blank = ( S ) -> $ ( d, send ) =>\n  return send d unless select d, '^blank'\n  $vnr = VNR.deepen d.$vnr\n  for _ in [ 1 .. ( d.linecount ? 0 ) ] by +1\n    $vnr = VNR.advance $vnr\n    send H.fresh_datom '^html', { text: '', ref: 'rdh/mkts-1', $vnr, }\n  send d\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@render = ( S ) -> new Promise ( resolve, reject ) =>\n  H.register_key S, '^html', { is_block: false, }\n  pipeline = []\n  # pipeline.push @$line      S\n  # pipeline.push @$decorations S\n  pipeline.push @$p           S\n  # pipeline.push @$mktscript   S\n  pipeline.push @$blank       S\n  DM.run_phase S, PD.pull pipeline...\n  #.........................................................................................................\n  # dbr = S.mirage.dbr\n  # dbw = S.mirage.dbw\n  # { to_width\n  #   width_of }              = require 'to-width'\n  # dbw.create_view_rows_mktscript_and_block_tags()\n  # for row from dbr.$.query \"select * from rows_mktscript_and_block_tags;\"\n  #   d = H.datom_from_row S, row\n  #   urge 'µ10922', jr d\n  # for row from dbr.texts_preceded_by_block_keys()\n  #   $vnr    = VNR.deepen JSON.parse row.vnr\n  #   text    = \"#{row.prv_key}>#{row.text}\"\n  #   d       = H.fresh_datom '^html', { text, $vnr, ref: 'rdh/x1', }\n  #   debug 'µ33431', jr d\n  #   dbw.insert H.row_from_datom S, d\n  # for row from dbr.texts_followed_by_block_keys()\n  #   urge 'µ33431', jr row\n  #   $vnr    = VNR.deepen JSON.parse row.vnr\n  #   text    = \"#{row.text}</#{row.nxt_key[ 1 .. ]}>\"\n  #   d       = H.fresh_datom '^html', { text, $vnr, ref: 'rdh/x2', }\n  #   urge 'µ33431', jr d\n  #   dbw.insert H.row_from_datom S, d\n  #.........................................................................................................\n  resolve()\n\n\n\n\n\n"
  ]
}