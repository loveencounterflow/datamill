{
  "version": 3,
  "file": "900-render-html.js",
  "sourceRoot": "..",
  "sources": [
    "src/900-render-html.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n\n\n'use strict'\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DATAMILL/MAIN'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n{ jr\n  assign }                = CND\n#...........................................................................................................\nrequire                   './exception-handler'\nfirst                     = Symbol 'first'\nlast                      = Symbol 'last'\nMIRAGE                    = require 'mkts-mirage'\nVNR                       = require './vnr'\n#...........................................................................................................\nPD                        = require 'pipedreams'\n{ $\n  $watch\n  $async\n  select\n  stamp }                 = PD\n#...........................................................................................................\n@types                    = require './types'\n{ isa\n  validate\n  cast\n  first_of\n  last_of\n  size_of\n  type_of }               = @types\n#...........................................................................................................\nH                         = require './helpers'\n{ cwd_abspath\n  cwd_relpath\n  here_abspath\n  project_abspath }       = H\n#...........................................................................................................\nDM                        = require '..'\n\n# #-----------------------------------------------------------------------------------------------------------\n# @$decorations = ( S ) -> $ { first, last, }, ( d, send ) =>\n#   if d is first\n#     send H.fresh_datom '^html', { text: '<html><body>', ref: 'rdh/deco-1', $vnr: [ -Infinity, ], }\n#   if d is last\n#     send H.fresh_datom '^html', { text: '</body></html>', ref: 'rdh/deco-2', $vnr: [ Infinity, ], }\n#   else\n#     send d\n#   return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$codeblocks = ( S ) ->\n  return H.leapfrog_stamped PD.lookaround $ ( d3, send ) =>\n    [ prv, d, nxt, ] = d3\n    return send d unless select d, '^literal'\n    if select prv,  '<codeblock'\n      $vnr  = VNR.deepen prv.$vnr\n      text  = \"<pre><code>\"\n      debug 'µ44455', '$codeblocks', jr prv\n      send H.fresh_datom '^html', { text, ref: 'rdh/cdb1', $vnr, }\n      send stamp prv\n    if select nxt,  '>codeblock'\n      $vnr  = VNR.deepen nxt.$vnr\n      text  = \"</code></pre>\"\n      send H.fresh_datom '^html', { text, ref: 'rdh/cdb2', $vnr, }\n      send stamp nxt\n    $vnr  = VNR.deepen d.$vnr\n    send H.fresh_datom '^html', { text: d.text, ref: 'rdh/cdb3', $vnr, }\n    send stamp d\n\n#-----------------------------------------------------------------------------------------------------------\n@$blocks_with_mktscript = ( S ) ->\n  key_registry    = H.get_key_registry S\n  is_block        = ( d ) -> key_registry[ d.key ]?.is_block\n  return PD.lookaround $ ( d3, send ) =>\n    [ prv, d, nxt, ] = d3\n    return send d unless select d, '^mktscript'\n    text = d.text\n    if is_block prv\n      tagname = prv.key[ 1 .. ]\n      ### TAINT use proper HTML generation ###\n      text    = \"<#{tagname}>#{text}\"\n      send stamp prv\n    if is_block nxt\n      tagname = nxt.key[ 1 .. ]\n      text    = \"#{text}</#{tagname}>\"\n      send stamp nxt\n    $vnr = VNR.deepen d.$vnr\n    send H.fresh_datom '^html', { text, ref: 'rdh/bwm', $vnr, }\n    send stamp d\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$other_blocks = ( S ) ->\n  key_registry    = H.get_key_registry S\n  is_block        = ( d ) -> key_registry[ d.key ]?.is_block\n  return H.resume_from_db S, { from_realm: 'html', }, $ ( d, send ) =>\n    return send d unless ( select d, '<>' ) and ( is_block d )\n    debug 'µ29882', '$other_blocks', jr d\n    tagname = d.key[ 1 .. ]\n    ### TAINT use proper HTML generation ###\n    if select d, '<' then text = \"<#{tagname}>\"\n    else                  text = \"</#{tagname}>\"\n    $vnr = VNR.deepen d.$vnr\n    send H.fresh_datom '^html', { text: text, ref: 'rdh/ob', $vnr, }\n    send stamp d\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n@$blank = ( S ) -> $ ( d, send ) =>\n  return send d unless select d, '^blank'\n  $vnr = VNR.deepen d.$vnr\n  if ( linecount = d.linecount ? 0 ) > 0\n    text = '\\n'.repeat linecount - 1\n    send H.fresh_datom '^html', { text, ref: 'rdh/mkts-1', $vnr, }\n  send stamp d\n\n#-----------------------------------------------------------------------------------------------------------\n@$set_realm = ( S, realm ) -> $ ( d, send ) =>\n  return send if d.realm? then d else PD.set d, { realm, }\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\npreamble = \"\"\"\n  <style>\n    * { padding: 4px; outline: 2px dotted green; }\n    </style>\n  \"\"\"\n\n#-----------------------------------------------------------------------------------------------------------\n### TAINT refactor to PipeStreams ###\nPD.$send_as_first = ( x ) -> $ { first, }, ( d, send ) -> send if d is first then x else d\nPD.$send_as_last  = ( x ) -> $ { last,  }, ( d, send ) -> send if d is last  then x else d\n\n#-----------------------------------------------------------------------------------------------------------\n@$write_to_file = ( S ) =>\n  pipeline  = []\n  pipeline.push H.$resume_from_db S, { from_realm: 'html', }\n  pipeline.push PD.$filter ( d ) -> select d, '^html'\n  pipeline.push $ ( d, send ) -> send d.text + '\\n'\n  pipeline.push PD.$send_as_first preamble\n  pipeline.push PD.write_to_file '/tmp/datamill.html'\n  return PD.$tee PD.pull pipeline...\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@settings =\n  from_realm:   'html'\n  to_realm:     'html'\n\n#-----------------------------------------------------------------------------------------------------------\n@$transform = ( S ) ->\n  H.register_key    S, '^html', { is_block: false, }\n  H.register_realm  S, @settings.to_realm\n  H.copy_realm      S, 'input', 'html'\n  pipeline = []\n  # pipeline.push @$decorations S\n  pipeline.push @$codeblocks              S\n  pipeline.push @$blocks_with_mktscript   S\n  # pipeline.push @$other_blocks            S\n  pipeline.push @$blank                   S\n  pipeline.push @$set_realm               S, @settings.to_realm\n  pipeline.push @$write_to_file           S\n  return PD.pull pipeline...\n\n\n\n\n\n"
  ]
}