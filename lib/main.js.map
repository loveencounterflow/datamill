{
  "version": 3,
  "file": "main.js",
  "sourceRoot": "..",
  "sources": [
    "src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n\n\n\n'use strict'\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'DATAMILL/MAIN'\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\ninfo                      = CND.get_logger 'info',      badge\nurge                      = CND.get_logger 'urge',      badge\nhelp                      = CND.get_logger 'help',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\necho                      = CND.echo.bind CND\n{ jr\n  assign }                = CND\n#...........................................................................................................\nrequire                   './exception-handler'\nfirst                     = Symbol 'first'\nlast                      = Symbol 'last'\nMIRAGE                    = require 'mkts-mirage'\nVNR                       = require './vnr'\n#...........................................................................................................\nPD                        = require 'pipedreams'\n{ $\n  $watch\n  $async\n  select\n  stamp }                 = PD\n#...........................................................................................................\n@types                    = require './types'\n{ isa\n  validate\n  declare\n  size_of\n  type_of }               = @types\n#...........................................................................................................\nH                         = require './helpers'\n{ cwd_abspath\n  cwd_relpath\n  here_abspath\n  project_abspath }       = H\n\n\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@run_phase = ( S, transform ) -> new Promise ( resolve, reject ) =>\n  source    = PD.new_push_source()\n  pipeline  = []\n  pipeline.push source\n  pipeline.push transform\n  # pipeline.push @$validate_symmetric_keys()\n  pipeline.push H.$feed_db S\n  pipeline.push PD.$drain => resolve()\n  PD.pull pipeline...\n  H.feed_source S, source\n\n#-----------------------------------------------------------------------------------------------------------\n@new_datamill = ( mirage ) ->\n  R =\n    mirage:     mirage\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@translate_document = ( mirage ) -> new Promise ( resolve, reject ) =>\n  S           = @new_datamill mirage\n  limit       = Infinity\n  phase_names = [\n    './000-initialize'\n    './005-start-stop'\n    './006-ignore'\n    './010-whitespace-1'\n    './020-blocks'\n    './025-whitespace-2'\n    # './030-1-paragraphs-breaks'\n    # './030-2-paragraphs-consolidate'\n    # './040-markdown-inline'\n    # './030-escapes'\n    # './035-special-forms'\n    './xxx-validation'\n    ]\n  #.........................................................................................................\n  XXX_count = 0\n  loop\n    XXX_count += +1\n    break if XXX_count > 1\n    debug 'µ33982', \"run-through #{XXX_count}\"\n    for phase_name in phase_names\n      phase     = require phase_name\n      pass_max  = 5\n      pass      = 0\n      loop\n        pass += +1\n        if pass >= pass_max\n          warn \"µ44343 enforced break, pass_max is #{pass_max}\"\n          break\n        help 'µ55567 ' + ( CND.reverse CND.yellow \" pass #{pass} \" ) + ( CND.lime \" phase #{phase_name} \" )\n        await @run_phase S, phase.$transform S\n        break unless H.repeat_phase S, phase\n        warn \"µ33443 repeating phase #{phase_name}\"\n  #.........................................................................................................\n  # H.show_overview S, { hilite: '^blank', }\n  H.show_overview S\n  resolve()\n  #.........................................................................................................\n  return null\n\n\n############################################################################################################\nunless module.parent?\n  do =>\n    #.......................................................................................................\n    settings =\n      file_path:    project_abspath './src/tests/demo.md'\n      # file_path:    project_abspath './src/tests/demo-simple-paragraphs.md'\n      # db_path:      ':memory:'\n      db_path:      project_abspath './db/datamill.db'\n      icql_path:    project_abspath './db/datamill.icql'\n      default_key:  '^line'\n      default_dest: 'main'\n      clear:        true\n    help \"using database at #{settings.db_path}\"\n    mirage  = await MIRAGE.create settings\n    await @translate_document mirage\n    # db      = mirage.db\n    # for row from db.$.query \"select * from dest_changes_backward order by vnr_blob;\"\n    #   delete row.vnr_blob\n    #   help jr row\n    # for row from db.$.query \"select * from dest_changes_forward order by vnr_blob;\"\n    #   delete row.vnr_blob\n    #   info jr row\n    # for row from db.read_changed_dest_last_lines()\n    #   delete row.vnr_blob\n    #   help jr row\n    # for row from db.read_changed_dest_first_lines()\n    #   delete row.vnr_blob\n    #   info jr row\n    # help 'ok'\n    return null\n\n\n\n\n"
  ]
}